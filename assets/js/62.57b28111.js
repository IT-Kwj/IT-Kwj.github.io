(window.webpackJsonp=window.webpackJsonp||[]).push([[62],{633:function(a,s,t){"use strict";t.r(s);var e=t(26),r=Object(e.a)({},function(){var a=this,s=a.$createElement,t=a._self._c||s;return t("ContentSlotsDistributor",{attrs:{"slot-key":a.$parent.slotKey}},[t("h1",{attrs:{id:"第10章-更多javascript打包工具"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#第10章-更多javascript打包工具","aria-hidden":"true"}},[a._v("#")]),a._v(" 第10章 更多Javascript打包工具")]),a._v(" "),t("p"),t("div",{staticClass:"table-of-contents"},[t("ul",[t("li",[t("a",{attrs:{href:"#rollup"}},[a._v("Rollup")]),t("ul",[t("li",[t("a",{attrs:{href:"#配置"}},[a._v("配置")])]),t("li",[t("a",{attrs:{href:"#tree-shaking"}},[a._v("tree shaking")])]),t("li",[t("a",{attrs:{href:"#可选的输出格式"}},[a._v("可选的输出格式")])])])]),t("li",[t("a",{attrs:{href:"#parcel"}},[a._v("Parcel")]),t("ul",[t("li",[t("a",{attrs:{href:"#打包速度"}},[a._v("打包速度")])]),t("li",[t("a",{attrs:{href:"#零配置"}},[a._v("零配置")])])])]),t("li",[t("a",{attrs:{href:"#打包工具的发展趋势"}},[a._v("打包工具的发展趋势")]),t("ul",[t("li",[t("a",{attrs:{href:"#性能与通用性"}},[a._v("性能与通用性")])]),t("li",[t("a",{attrs:{href:"#webassembly"}},[a._v("WebAssembly")])])])])])]),t("p"),a._v(" "),t("h2",{attrs:{id:"rollup"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#rollup","aria-hidden":"true"}},[a._v("#")]),a._v(" Rollup")]),a._v(" "),t("p",[a._v("webpack优势在于更全面，“一切皆模块”的思想衍生出丰富的loader和plugin。Rollup更像一把手术刀，它更专注于js的打包。虽然也支持其他类型的模块，但总体上还是不如webpack。如果需求只是打包js，比如一个js库，Rollup有时候是第一选择。")]),a._v(" "),t("h3",{attrs:{id:"配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#配置","aria-hidden":"true"}},[a._v("#")]),a._v(" 配置")]),a._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// rollup.config.js")]),a._v("\nmodule"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("exports "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("=")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n    input"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'src/app.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n    output"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("\n        file"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'dist/bundle.js'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v("\n        format"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(":")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'cjs'")]),a._v("\n    "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v("\n\n"),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// src/app.js")]),a._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"xxx"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br"),t("span",{staticClass:"line-number"},[a._v("4")]),t("br"),t("span",{staticClass:"line-number"},[a._v("5")]),t("br"),t("span",{staticClass:"line-number"},[a._v("6")]),t("br"),t("span",{staticClass:"line-number"},[a._v("7")]),t("br"),t("span",{staticClass:"line-number"},[a._v("8")]),t("br"),t("span",{staticClass:"line-number"},[a._v("9")]),t("br"),t("span",{staticClass:"line-number"},[a._v("10")]),t("br"),t("span",{staticClass:"line-number"},[a._v("11")]),t("br")])]),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("npm i rollup "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("g\n\nrollup "),t("span",{pre:!0,attrs:{class:"token operator"}},[a._v("-")]),a._v("c rollup"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("config"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("js\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br"),t("span",{staticClass:"line-number"},[a._v("3")]),t("br")])]),t("p",[a._v("打包结果如下：")]),a._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'use strict'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 可以通过output.strict去掉")]),a._v("\nconsole"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("log")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token string"}},[a._v('"xxx"')]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("可以看到打包出来的东西很干净，Rollup并没添加什么额外的代码。webpack会将自身代码注入进去。")]),a._v(" "),t("h3",{attrs:{id:"tree-shaking"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#tree-shaking","aria-hidden":"true"}},[a._v("#")]),a._v(" tree shaking")]),a._v(" "),t("p",[a._v("tree shaking这个特性最开始是有Rollup实现的，而后被webpack借鉴。")]),a._v(" "),t("p",[a._v("Rollup的tree shaking也是基于ES6 Modules的静态分析，找出没有被引用过的模块，将其从最后生成的bundle中排除。")]),a._v(" "),t("h3",{attrs:{id:"可选的输出格式"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#可选的输出格式","aria-hidden":"true"}},[a._v("#")]),a._v(" 可选的输出格式")]),a._v(" "),t("p",[a._v("Rollup有一项webpack不具备的特性，通过配置output.format开发者可以选择输出资源的模块形式。cjs(CommonJS)、amd、esm、iife、umd和system。这对于打包js库特别有用。")]),a._v(" "),t("h2",{attrs:{id:"parcel"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#parcel","aria-hidden":"true"}},[a._v("#")]),a._v(" Parcel")]),a._v(" "),t("p",[a._v("Parcel相对于webpack是后来者。在Parcel官网测试中，在有缓存的情况下其打包速度要比webpack快将近8倍，且宣称是零配置的。")]),a._v(" "),t("h3",{attrs:{id:"打包速度"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打包速度","aria-hidden":"true"}},[a._v("#")]),a._v(" 打包速度")]),a._v(" "),t("p",[a._v("Parcel在打包速度的优化上主要做了3件事：")]),a._v(" "),t("ol",[t("li",[a._v("利用worker来并行执行任务。")]),a._v(" "),t("li",[a._v("文件系统缓存。")]),a._v(" "),t("li",[a._v("资源编译处理流程优化。")])]),a._v(" "),t("p",[a._v("webpack在资源压缩时可以利用多核同时压缩多个资源。本地缓存更多是在loader的层面。")]),a._v(" "),t("p",[a._v("webpack主要靠loader来处理各种不同类型的资源。loader本质上就是一个函数，一般情况下它的输入和输出都是字符串。babel-loader工作流程分为：")]),a._v(" "),t("ul",[t("li",[a._v("将ES6形式的字符串内容解析为AST")]),a._v(" "),t("li",[a._v("对AST进行语法转换")]),a._v(" "),t("li",[a._v("生成ES5代码，并作为字符串返回")])]),a._v(" "),t("p",[a._v("如果是多个loader依次对资源进行处理：\n"),t("img",{attrs:{src:"/images/Webpack%E5%AE%9E%E6%88%98/loader.jpg",alt:"loader"}})]),a._v(" "),t("p",[a._v("不同loader不需要知道彼此的存在。虽然产出一些冗余步骤，但是这有助于保持loader的独立性和可维护性。")]),a._v(" "),t("p",[a._v("Parcel的资源处理流程：\n"),t("img",{attrs:{src:"/images/Webpack%E5%AE%9E%E6%88%98/Parcel.jpg",alt:"Parcel"}})]),a._v(" "),t("h3",{attrs:{id:"零配置"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#零配置","aria-hidden":"true"}},[a._v("#")]),a._v(" 零配置")]),a._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[a._v("parcel index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("html "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 启用开发者模式")]),a._v("\nparcel build index"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(".")]),a._v("html "),t("span",{pre:!0,attrs:{class:"token comment"}},[a._v("// 打包")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("虽然Parcel并没有属于自己的配置文件，但本质上它是把配置进行了切分，交给Babel、PostCSS等一些特定工具进行分别管理。比如当项目中有.babelrc时，那么Parcel打包时就会采用它作为ES6代码解析的配置。")]),a._v(" "),t("h2",{attrs:{id:"打包工具的发展趋势"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#打包工具的发展趋势","aria-hidden":"true"}},[a._v("#")]),a._v(" 打包工具的发展趋势")]),a._v(" "),t("h3",{attrs:{id:"性能与通用性"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#性能与通用性","aria-hidden":"true"}},[a._v("#")]),a._v(" 性能与通用性")]),a._v(" "),t("p",[a._v("进行技术选型时要看当前项目的需求，在通用性和性能之间做一些权衡。")]),a._v(" "),t("h3",{attrs:{id:"webassembly"}},[t("a",{staticClass:"header-anchor",attrs:{href:"#webassembly","aria-hidden":"true"}},[a._v("#")]),a._v(" WebAssembly")]),a._v(" "),t("p",[a._v("WebAssembly主要特性是性能可以媲美于原生，像C和java等语言都可以编译为WebAssembly在现代浏览器上运行。")]),a._v(" "),t("p",[a._v("目前webpack、Rollup还是Parcel，都能找到对WebAssembly的支持。")]),a._v(" "),t("div",{staticClass:"language-js line-numbers-mode"},[t("pre",{pre:!0,attrs:{class:"language-js"}},[t("code",[t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("import")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("{")]),a._v("add"),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("}")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token keyword"}},[a._v("from")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token string"}},[a._v("'./util.wasm'")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n"),t("span",{pre:!0,attrs:{class:"token function"}},[a._v("add")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v("(")]),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("2")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(",")]),a._v(" "),t("span",{pre:!0,attrs:{class:"token number"}},[a._v("3")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(")")]),t("span",{pre:!0,attrs:{class:"token punctuation"}},[a._v(";")]),a._v("\n")])]),a._v(" "),t("div",{staticClass:"line-numbers-wrapper"},[t("span",{staticClass:"line-number"},[a._v("1")]),t("br"),t("span",{staticClass:"line-number"},[a._v("2")]),t("br")])]),t("p",[a._v("假如loader及同类的编译工具足够强大，你可以引用一段C代码，然后让它运行在浏览器环境中。")])])},[],!1,null,null,null);s.default=r.exports}}]);